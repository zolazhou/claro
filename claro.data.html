<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>claro.data documentation</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="highlight/solarized-light.css" /><script type="text/javascript" src="highlight/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a> with <a href="https://github.com/xsc/codox-theme-rdash">RDash UI</a> theme</h2><h1><a href="index.html"><span class="project-title"><span class="project-name">claro</span> <span class="project-version">0.2.17</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Topics</span></h3><ul><li class="depth-1 "><a href="00-basics.html"><div class="inner"><span>Basic Resolution</span></div></a></li><li class="depth-1 "><a href="01-projection.html"><div class="inner"><span>Projections</span></div></a></li><li class="depth-1 "><a href="02-advanced-projection.html"><div class="inner"><span>Advanced Projections</span></div></a></li><li class="depth-1 "><a href="03-engine.html"><div class="inner"><span>Engine</span></div></a></li><li class="depth-1 "><a href="04-testing-and-debugging.html"><div class="inner"><span>Testing &amp; Debugging</span></div></a></li><li class="depth-1 "><a href="99-notes.html"><div class="inner"><span>Implementation Notes</span></div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>claro</span></div></div></li><li class="depth-2 current"><a href="claro.data.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>data</span></div></a></li><li class="depth-3"><a href="claro.data.ops.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>ops</span></div></a></li><li class="depth-2"><a href="claro.engine.html"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>engine</span></div></a></li><li class="depth-3 branch"><a href="claro.engine.adapter.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>adapter</span></div></a></li><li class="depth-3"><a href="claro.engine.selector.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>selector</span></div></a></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>middleware</span></div></div></li><li class="depth-3 branch"><a href="claro.middleware.deferred.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>deferred</span></div></a></li><li class="depth-3 branch"><a href="claro.middleware.mock.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>mock</span></div></a></li><li class="depth-3 branch"><a href="claro.middleware.observe.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>observe</span></div></a></li><li class="depth-3"><a href="claro.middleware.transform.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>transform</span></div></a></li><li class="depth-2"><a href="claro.projection.html"><div class="inner"><span class="tree" style="top: -145px;"><span class="top" style="height: 154px;"></span><span class="bottom"></span></span><span>projection</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="claro.data.html#var-batched-resolvable.3F"><div class="inner"><span>batched-resolvable?</span></div></a></li><li class="depth-1"><a href="claro.data.html#var-BatchedResolvable"><div class="inner"><span>BatchedResolvable</span></div></a></li><li class="depth-1"><a href="claro.data.html#var-collect-errors"><div class="inner"><span>collect-errors</span></div></a></li><li class="depth-1"><a href="claro.data.html#var-Cost"><div class="inner"><span>Cost</span></div></a></li><li class="depth-1"><a href="claro.data.html#var-cost"><div class="inner"><span>cost</span></div></a></li><li class="depth-1"><a href="claro.data.html#var-error"><div class="inner"><span>error</span></div></a></li><li class="depth-1"><a href="claro.data.html#var-error-data"><div class="inner"><span>error-data</span></div></a></li><li class="depth-1"><a href="claro.data.html#var-error-message"><div class="inner"><span>error-message</span></div></a></li><li class="depth-1"><a href="claro.data.html#var-error.3F"><div class="inner"><span>error?</span></div></a></li><li class="depth-1"><a href="claro.data.html#var-extend-list-transform"><div class="inner"><span>extend-list-transform</span></div></a></li><li class="depth-1"><a href="claro.data.html#var-extend-transform"><div class="inner"><span>extend-transform</span></div></a></li><li class="depth-1"><a href="claro.data.html#var-Mutation"><div class="inner"><span>Mutation</span></div></a></li><li class="depth-1"><a href="claro.data.html#var-mutation.3F"><div class="inner"><span>mutation?</span></div></a></li><li class="depth-1"><a href="claro.data.html#var-Parameters"><div class="inner"><span>Parameters</span></div></a></li><li class="depth-1"><a href="claro.data.html#var-Partition"><div class="inner"><span>Partition</span></div></a></li><li class="depth-1"><a href="claro.data.html#var-partition-by"><div class="inner"><span>partition-by</span></div></a></li><li class="depth-1"><a href="claro.data.html#var-pure-resolvable.3F"><div class="inner"><span>pure-resolvable?</span></div></a></li><li class="depth-1"><a href="claro.data.html#var-PureResolvable"><div class="inner"><span>PureResolvable</span></div></a></li><li class="depth-1"><a href="claro.data.html#var-Resolvable"><div class="inner"><span>Resolvable</span></div></a></li><li class="depth-1"><a href="claro.data.html#var-resolvable.3F"><div class="inner"><span>resolvable?</span></div></a></li><li class="depth-1"><a href="claro.data.html#var-resolve.21"><div class="inner"><span>resolve!</span></div></a></li><li class="depth-1"><a href="claro.data.html#var-resolve-batch.21"><div class="inner"><span>resolve-batch!</span></div></a></li><li class="depth-1"><a href="claro.data.html#var-set-parameters"><div class="inner"><span>set-parameters</span></div></a></li><li class="depth-1"><a href="claro.data.html#var-Transform"><div class="inner"><span>Transform</span></div></a></li><li class="depth-1"><a href="claro.data.html#var-transform"><div class="inner"><span>transform</span></div></a></li><li class="depth-1"><a href="claro.data.html#var-unless-error-.3E"><div class="inner"><span>unless-error-&gt;</span></div></a></li><li class="depth-1"><a href="claro.data.html#var-unless-error-.3E.3E"><div class="inner"><span>unless-error-&gt;&gt;</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">claro.data</h1><div class="doc"><div class="markdown"><p>Main protocols and functions for I/O abstraction.</p>
<p>See <a href="00-basics.html">Basic Resolution</a> for details and examples.</p></div></div><div class="public anchor" id="var-batched-resolvable.3F"><h3>batched-resolvable?</h3><h4 class="added">added in 0.2.7</h4><div class="usage"><code>(batched-resolvable? value)</code></div><div class="doc"><div class="markdown"><p>Check whether the given value implements the <code>Resolvable</code> protocol.</p></div></div><div class="src-link"><a href="https://github.com/xsc/claro/blob/master/src/claro/data/protocols.cljc#L30">view source</a></div></div><div class="public anchor" id="var-BatchedResolvable"><h3>BatchedResolvable</h3><h4 class="type">protocol</h4><div class="usage"></div><div class="doc"><div class="markdown"><p>Interface for values that can be resolved in batches.</p>
<p>Do not use with <code>extend-type</code> or <code>extend-protocol</code>!</p></div></div><div class="src-link"><a href="https://github.com/xsc/claro/blob/master/src/claro/data/protocols.cljc#L16">view source</a></div></div><div class="public anchor" id="var-collect-errors"><h3>collect-errors</h3><h4 class="added">added in 0.2.1</h4><div class="usage"><code>(collect-errors value)</code></div><div class="doc"><div class="markdown"><p>Find all errors within the given value.</p></div></div><div class="src-link"><a href="https://github.com/xsc/claro/blob/master/src/claro/data/error.cljc#L54">view source</a></div></div><div class="public anchor" id="var-Cost"><h3>Cost</h3><h4 class="type">protocol</h4><h4 class="added">added in 0.2.6</h4><div class="usage"></div><div class="doc"><div class="markdown"><p>Protocol describing resolution cost for a batch of resolvables. The following default values are produced:</p>
<ul>
  <li><code>0</code> for batches of <code>PureResolvable</code>,</li>
  <li><code>1</code> for batches of <code>BatchedResolvables</code></li>
  <li><code>(count batch)</code> for other batches.</li>
</ul>
<p>The overall cost can be used when declaring engines by supplying the <code>:max-cost</code> option.</p></div></div><div class="src-link"><a href="https://github.com/xsc/claro/blob/master/src/claro/data/protocols.cljc#L51">view source</a></div></div><div class="public anchor" id="var-cost"><h3>cost</h3><h4 class="added">added in 0.2.6</h4><div class="usage"><code>(cost resolvable batch)</code></div><div class="doc"><div class="markdown"><p>Calculate the cost of resolution for the given batch.</p></div></div><div class="src-link"><a href="https://github.com/xsc/claro/blob/master/src/claro/data.cljc#L12">view source</a></div></div><div class="public anchor" id="var-error"><h3>error</h3><h4 class="added">added in 0.2.1</h4><div class="usage"><code>(error message &amp; [data])</code></div><div class="doc"><div class="markdown"><p>Generate a value representing a resolution error.</p></div></div><div class="src-link"><a href="https://github.com/xsc/claro/blob/master/src/claro/data/error.cljc#L32">view source</a></div></div><div class="public anchor" id="var-error-data"><h3>error-data</h3><h4 class="added">added in 0.2.1</h4><div class="usage"><code>(error-data e)</code></div><div class="doc"><div class="markdown"><p>Retrieve error data from the given <a href="claro.data.html#var-error">error</a> value.</p></div></div><div class="src-link"><a href="https://github.com/xsc/claro/blob/master/src/claro/data/error.cljc#L49">view source</a></div></div><div class="public anchor" id="var-error-message"><h3>error-message</h3><h4 class="added">added in 0.2.1</h4><div class="usage"><code>(error-message e)</code></div><div class="doc"><div class="markdown"><p>Retrieve the message from the given <a href="claro.data.html#var-error">error</a> value.</p></div></div><div class="src-link"><a href="https://github.com/xsc/claro/blob/master/src/claro/data/error.cljc#L44">view source</a></div></div><div class="public anchor" id="var-error.3F"><h3>error?</h3><h4 class="added">added in 0.2.1</h4><div class="usage"><code>(error? value)</code></div><div class="doc"><div class="markdown"><p>Check whether the given value represents a resolution error.</p></div></div><div class="src-link"><a href="https://github.com/xsc/claro/blob/master/src/claro/data/error.cljc#L39">view source</a></div></div><div class="public anchor" id="var-extend-list-transform"><h3>extend-list-transform</h3><h4 class="type">macro</h4><h4 class="added">added in 0.2.7</h4><div class="usage"><code>(extend-list-transform resolvable-class [element-constructor &amp; args])</code><code>(extend-list-transform resolvable-class element-constructor &amp; more)</code></div><div class="doc"><div class="markdown"><p>Implement the <a href="claro.data.html#var-Transform">Transform</a> protocol for the given <code>resolvable-class</code>, assuming it returns a seq of elements to-be-processed with <code>element-constructor</code>.</p>
<pre><code class="clojure">(extend-list-transform
  PeopleByLocation
  [-&gt;Person])
</code></pre>
<p>This is equivalent to:</p>
<pre><code class="clojure">(extend-protocol claro.data/Transform
  PeopleByLocation
  (transform [_ results]
    (mapv -&gt;Person results)))
</code></pre>
<p>It’s also possible to supply extra parameters to be passed to the element constructor, e.g.:</p>
<pre><code class="clojure">(extend-list-transform
  PeopleByLocation
  [-&gt;Person {:by :location}])
</code></pre>
<p>This will call <code>(-&gt;Person element {:by :location})</code> on each element.</p></div></div><div class="src-link"><a href="https://github.com/xsc/claro/blob/master/src/claro/data/transform.clj#L4">view source</a></div></div><div class="public anchor" id="var-extend-transform"><h3>extend-transform</h3><h4 class="type">macro</h4><h4 class="added">added in 0.2.7</h4><div class="usage"><code>(extend-transform resolvable-class fields)</code><code>(extend-transform resolvable-class fields &amp; more)</code></div><div class="doc"><div class="markdown"><p>Implement the <a href="claro.data.html#var-Transform">Transform</a> protocol for the given <code>resolvable-class</code> by transforming/renaming fields according to a given field spec.</p>
<pre><code class="clojure">(extend-transform
  Person
  {:pet      [-&gt;Pet :pet-id]
   :location (fn [{:keys [latitude longitude]}]
               (-&gt;Location latitude longitude))
   :name     :username})
</code></pre>
<p>This will:</p>
<ul>
  <li>create <code>:pet</code> as <code>(-&gt;Pet (:pet-id result))</code>,</li>
  <li>create <code>:location</code> as the result of the given function, and</li>
  <li>copy <code>:username</code> to <code>:name</code>.</li>
</ul>
<p>All these take the resolution result (!) as input but will not alter <code>nil</code> values.</p></div></div><div class="src-link"><a href="https://github.com/xsc/claro/blob/master/src/claro/data/transform.clj#L46">view source</a></div></div><div class="public anchor" id="var-Mutation"><h3>Mutation</h3><h4 class="type">protocol</h4><div class="usage"></div><div class="doc"><div class="markdown"><p>Marker interface for mutations, applying the following constraints on resolution:</p>
<ul>
  <li>only resolve on top-level (i.e. <code>resolve!</code> cannot return a mutation),</li>
  <li>only resolve one mutation per run,</li>
  <li>run mutation before any other resolvables.</li>
</ul>
<p>Do not use with <code>extend-type</code> or <code>extend-protocol</code>.</p></div></div><div class="src-link"><a href="https://github.com/xsc/claro/blob/master/src/claro/data/protocols.cljc#L114">view source</a></div></div><div class="public anchor" id="var-mutation.3F"><h3>mutation?</h3><h4 class="added">added in 0.2.7</h4><div class="usage"><code>(mutation? value)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/xsc/claro/blob/master/src/claro/data/protocols.cljc#L124">view source</a></div></div><div class="public anchor" id="var-Parameters"><h3>Parameters</h3><h4 class="type">protocol</h4><div class="usage"></div><div class="doc"><div class="markdown"><p>Protocol for custom parameter handling for Resolvables.</p></div></div><div class="src-link"><a href="https://github.com/xsc/claro/blob/master/src/claro/data/protocols.cljc#L130">view source</a></div></div><div class="public anchor" id="var-Partition"><h3>Partition</h3><h4 class="type">protocol</h4><h4 class="added">added in 0.2.10</h4><div class="usage"></div><div class="doc"><div class="markdown"><p>Protocol enhancing batching capabilities by allowing batches to be partitioned using some per-resolvable-class criterion.</p>
<p>This is only used for batched resolvables.</p></div></div><div class="src-link"><a href="https://github.com/xsc/claro/blob/master/src/claro/data/protocols.cljc#L73">view source</a></div></div><div class="public anchor" id="var-partition-by"><h3>partition-by</h3><div class="usage"><code>(partition-by resolvable)</code></div><div class="doc"><div class="markdown"><p>Calculate a partitioning key for the given resolvable. Resolvables with the same partitioning key will be resolved within the same batch.</p></div></div><div class="src-link"><a href="https://github.com/xsc/claro/blob/master/src/claro/data.cljc#L12">view source</a></div></div><div class="public anchor" id="var-pure-resolvable.3F"><h3>pure-resolvable?</h3><h4 class="added">added in 0.2.7</h4><div class="usage"><code>(pure-resolvable? value)</code></div><div class="doc"><div class="markdown"><p>Check whether the given value implements the <code>PureResolvable</code> protocol.</p></div></div><div class="src-link"><a href="https://github.com/xsc/claro/blob/master/src/claro/data/protocols.cljc#L35">view source</a></div></div><div class="public anchor" id="var-PureResolvable"><h3>PureResolvable</h3><h4 class="type">protocol</h4><div class="usage"></div><div class="doc"><div class="markdown"><p>Interface for values whose resolution is done using a pure function, i.e. there is no I/O or statefulness involved.</p>
<p>Do not use with <code>extend-type</code> or <code>extend-protocol</code>!</p></div></div><div class="src-link"><a href="https://github.com/xsc/claro/blob/master/src/claro/data/protocols.cljc#L24">view source</a></div></div><div class="public anchor" id="var-Resolvable"><h3>Resolvable</h3><h4 class="type">protocol</h4><div class="usage"></div><div class="doc"><div class="markdown"><p>Interface for resolvable values.</p>
<p>Do not use with <code>extend-type</code> or <code>extend-protocol</code>!</p></div></div><div class="src-link"><a href="https://github.com/xsc/claro/blob/master/src/claro/data/protocols.cljc#L7">view source</a></div></div><div class="public anchor" id="var-resolvable.3F"><h3>resolvable?</h3><div class="usage"><code>(resolvable? value)</code></div><div class="doc"><div class="markdown"><p>Check whether the given value implements the <code>Resolvable</code> protocol.</p>
<p>NOTE: Before version 0.2.7 this did not return true for <code>BatchedResolvable</code>  records.</p></div></div><div class="src-link"><a href="https://github.com/xsc/claro/blob/master/src/claro/data/protocols.cljc#L40">view source</a></div></div><div class="public anchor" id="var-resolve.21"><h3>resolve!</h3><div class="usage"><code>(resolve! resolvable env)</code></div><div class="doc"><div class="markdown"><p>Resolve the given value within the given environment, returning a manifold deferrable representing the resolution result. This might yield a structure containing more <code>Resolvable</code>s.</p></div></div><div class="src-link"><a href="https://github.com/xsc/claro/blob/master/src/claro/data.cljc#L12">view source</a></div></div><div class="public anchor" id="var-resolve-batch.21"><h3>resolve-batch!</h3><div class="usage"><code>(resolve-batch! resolvable env all-resolvables)</code></div><div class="doc"><div class="markdown"><p>Resolve <code>all-resolvables</code> (which is a seq including <code>resolvable</code>), returning a manifold deferrable containing a seq with resolved values in-order.</p></div></div><div class="src-link"><a href="https://github.com/xsc/claro/blob/master/src/claro/data.cljc#L12">view source</a></div></div><div class="public anchor" id="var-set-parameters"><h3>set-parameters</h3><div class="usage"><code>(set-parameters this parameters)</code></div><div class="doc"><div class="markdown"><p>Set the current resolvable’s parameters, returning an updated resolvable.</p>
<p>This is used by the <a href="claro.projection.html#var-parameters">parameters</a> projection for injection.</p></div></div><div class="src-link"><a href="https://github.com/xsc/claro/blob/master/src/claro/data.cljc#L12">view source</a></div></div><div class="public anchor" id="var-Transform"><h3>Transform</h3><h4 class="type">protocol</h4><div class="usage"></div><div class="doc"><div class="markdown"><p>Protocol for post-processing the result of <a href="claro.data.html#var-resolve.21">resolve!</a> and the single results of <a href="claro.data.html#var-resolve-batch.21">resolve-batch!</a>.</p></div></div><div class="src-link"><a href="https://github.com/xsc/claro/blob/master/src/claro/data/protocols.cljc#L100">view source</a></div></div><div class="public anchor" id="var-transform"><h3>transform</h3><div class="usage"><code>(transform resolvable resolve-result)</code></div><div class="doc"><div class="markdown"><p>Transform the result of <a href="claro.data.html#var-resolve.21">resolve!</a> (or a single result of <a href="claro.data.html#var-resolve-batch.21">resolve-batch!</a>) for the current <a href="claro.data.html#var-Resolvable">Resolvable</a> class..</p></div></div><div class="src-link"><a href="https://github.com/xsc/claro/blob/master/src/claro/data.cljc#L12">view source</a></div></div><div class="public anchor" id="var-unless-error-.3E"><h3>unless-error-&gt;</h3><h4 class="type">macro</h4><h4 class="added">added in 0.2.9</h4><div class="usage"><code>(unless-error-&gt; value &amp; body)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/xsc/claro/blob/master/src/claro/data/error.cljc#L68">view source</a></div></div><div class="public anchor" id="var-unless-error-.3E.3E"><h3>unless-error-&gt;&gt;</h3><h4 class="type">macro</h4><h4 class="added">added in 0.2.9</h4><div class="usage"><code>(unless-error-&gt;&gt; value &amp; body)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/xsc/claro/blob/master/src/claro/data/error.cljc#L77">view source</a></div></div></div></body></html>